# ブレンド

ブレンドはBGやスプライトから2つのグループを選択し、一定の割合で色を混ぜて表示するアルファブレンドと、白か黒を一定の割合で混ぜて表示するフェードがあります

## 0x0400_0050 - BLDCNT - ブレンド制御レジスタ (R/W)

 bit | 内容
---- | ----
0     | BG0を1stターゲットに
1     | BG1を1stターゲットに
2     | BG2を1stターゲットに
3     | BG3を1stターゲットに
4     | OBJ 1st Target Pixel (Top-most OBJ pixel)
5     | BD  1st Target Pixel (Backdrop)
6-7   | 特殊効果の種類 (後述)  
8     | BG0を2ndターゲットに
9     | BG1を2ndターゲットに
10    | BG2を2ndターゲットに
11    | BG3を2ndターゲットに
12    | OBJ 2nd Target Pixel (Top-most OBJ pixel)
13    | BD  2nd Target Pixel (Backdrop)
14-15 | 未使用

第1ターゲットと第2ターゲットに、どのBGやスプライトを割り当てるかの設定です。両方のグループに同じものを割り当てることもできます。

BG0-BG3はその番号のBG、OBJはスプライトすべて、BDは背景(詳細は不明)です。

フェードモードのときは第1ターゲットに設定したものだけが対象になります。

スプライトはスプライト同士の色の混ぜ合わせは行われないようです。

すべてのレイヤーが第1ターゲットと第2ターゲットの両方を選択することも可能で、 その場合は最上位の画素が第1ターゲットとなり、 次の下位の画素が第2ターゲットとなります。

### 特殊効果(bit6-7)

- 0: 特殊効果なし
- 1: 2つのグループの色を混ぜ合わせるアルファブレンド
- 2: 白フェード。グループと白色を一定の割合で混ぜます
- 3: 黒フェード。グループと黒色を一定の割合で混ぜます

## 0x0400_0052 - BLDALPHA - アルファブレンド (R/W)

 bit | 内容
---- | ----
0-4   | EVA - 第1ターゲット色割合 (0..16 = 0/16..16/16, 17..31=16/16)
5-7   | 未使用
8-12  | EVB - 第2ターゲット色割合 (0..16 = 0/16..16/16, 17..31=16/16)
13-15 | 未使用

各ピクセルのRGBは次のように計算されます。

```
R = min(31, R1*EVA + R2*EVB)
G = min(31, G1*EVA + G2*EVB)
B = min(31, B1*EVA + B2*EVB)
```

## 0x0400_0054 - BLDY - フェード (W)

 bit | 内容
---- | ----
0-4  | EVY - フェード率 (0..16 = 0/16..16/16, 17..31=16/16)
5-31 | 未使用

各ピクセルのRGBは次のように計算されます。

**白フェード**

```
R = R1 + (31-R1)*EVY
G = G1 + (31-G1)*EVY
B = B1 + (31-B1)*EVY
```

どれも255に近づいているので明るくなり白に近づいています。

**黒フェード**

```
R = R1 - (R1)*EVY
G = G1 - (G1)*EVY
B = B1 - (B1)*EVY
```

## 半透明のOBJ

OAMで半透明と定義されているOBJは、(BLDCNTビット4に関係なく)常に第1ターゲットとして選択され、(BLDCNTビット6-7に関係なく)常にアルファブレンドが適用されます。

BLDCNTレジスタは、OBJ（または 他のBG/BDレイヤー）に対してフェードを行うために使用することもできます。

しかし、半透明のOBJピクセルが第2ターゲットのピクセルと重なっている場合、半透明なOBJに対するアルファブレンドが優先され、（第1ターゲットも第2ターゲットも）フェードは行われません。。
## 補足

アルファブレンドは、OBJ-to-BGやBG-to-OBJには使用できますが、OBJ-to-OBJには使用できません。

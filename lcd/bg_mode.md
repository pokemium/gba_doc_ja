# BGモード

GBAは96KBのVRAMを`0x0600_0000-0x0601_7fff`に持っています。VRAMの使い方は[LCD制御レジスタ](./lcd_control.md)で設定するBGモードによって異なります。

また1タイル= 8px × 8px です。

## 🟫 BGモード 0,1,2 (タイルモード)

- `0x06000000-0x0600FFFF`:  64KBでBGマップとBGタイルデータで共有
- `0x06010000-0x06017FFF`:  32KBでOBJタイルデータが格納

64KBのメモリ空間をBGマップとBGタイルデータで共有します。それぞれのリソースがどのアドレスを使うかはBG0CNT-BG3CNTレジスタで決定します。

マップアドレスは2K（0x800）、タイルアドレスは16K（0x4000）単位で指定することができます。

### BGモード0 (タイルモード(テキスト))

このモードではBG0-3の4枚のレイヤを利用可能です。

タイルは4bit(16色)または8bit(256色)の色深度を持つ場合があります。

`1タイル = 8px × 8px = 64px`なので1タイルあたり

- 16色: 32 Bytes
- 256色: 64 Bytes

となります。

またマップサイズは最小32×32タイル、最大64×64タイルで、1マップあたり最大1024タイルまで使用できます。

1024タイルのデータ量は先程の1タイルのデータサイズに1024を掛けて

- 16色: 32KB
- 256色: 64KB

となり、マップ領域のデータサイズは

- 32×32: 2KB
- 64×64: 8KB

となります。

### BGモード1 (タイルモード(テキスト) + タイルモード(伸縮回転))

モード1には、伸縮回転可能なBG、不可能なBG(テキスト)の２種類があります。

伸縮可能なBGは後述のBGモード2とほぼ同じで、不可能な方は前述のBGモード0とほぼ同じです。

- マップサイズ:	32x32～64x64 + 16x16～128x128
- 画面数:	2(BG0-1) + 1(BG2)
- 色/パレット:	16色/16パレットor256色/1パレット + 256色/1パレット
- タイル定義数:	1024 + 256
- 伸縮回転:	不可能 + 可能

### BGモード2 (タイルモード(伸縮回転))

タイルの色深度は8bitのみで、最小マップサイズは16×16タイル、最大は128×128タイルで、1マップあたり最大256タイルまで使用可能です。

- マップサイズ:	16x16～128x128
- 画面数:	2(BG2-3)
- 色/パレット:	256色/1パレット
- キャラクタ定義数:	256
- 伸縮回転:	可能

## 🖍 BGモード 3,4,5(ビットマップモード)

ビットマップモードはとあるメモリ領域に値を書き込むと、それがそのまま画面に反映されます。

### BGモード3 (ビットマップモード for still images)

- `0x0600_0000-0x0601_3FFF`:  80KBのフレームバッファ0 (使えるのは75KB)
- `0x0601_4000-0x0601_7FFF`:  16KBでOBJタイルデータが格納

フレームバッファとして予約されているのは80KBですが75KBしか使えません。

- サイズ(px): 240×160
- フレームバッファ: 1つ
- 色/パレット: 32768色
- 伸縮回転: 可能

### BGモード4 (ビットマップモード)

- `0x0600_0000-0x0600_9FFF`: 37.5KBのフレームバッファ0
- `0x0600_A000-0x0601_3FFF`: 37.5KBのフレームバッファ1
- `0x0601_4000-0x0601_7FFF`: 16KBでOBJタイルデータが格納

フレームバッファとして予約されているのはモード5同様40KBですがモード4では37.5KBしか使えません。

- サイズ(px): 240×160
- フレームバッファ: 2つ
- 色/パレット: 256色/1パレット
- 伸縮回転: 可能

### BGモード5 (ビットマップモード)

- `0x0600_0000-0x0600_9FFF`: 40KBのフレームバッファ0
- `0x0600_A000-0x0601_3FFF`: 40KBのフレームバッファ1
- `0x0601_4000-0x0601_7FFF`: 16KBでOBJタイルデータが格納

こちらはフレームバッファは40KB全部利用可能です。

- サイズ(px): 160×128
- フレームバッファ: 2つ
- 色/パレット: 32768色
- 伸縮回転: 可能


# メモリマップ

## メモリマップ

**内部メモリ**

空いている領域は未使用領域です。

アドレス | サイズ | バス幅 | 名称 | 用途
---- | ---- | ---- | ---- | ----
00000000-00003FFF | 16KB | 32bit | BIOS | 起動プログラムなどを実装したROM
02000000-0203FFFF | 256KB | 16bit | WRAM(オンボード) | プログラムを入れる外部メモリ
03000000-03007FFF | 32KB | 32bit | WRAM(チップ) | ARM内蔵の高速メモリ
04000000-040003FE | 1KB | 32bit | IOレジスタ | IO機能を制御するレジスタ

**内部メモリ(画面描画用)**

空いている領域は未使用領域です。

アドレス | サイズ | バス幅 | 名称 | 用途
---- | ---- | ---- | ---- | ----
05000000-050003FF | 1KB | 16bit | パレット | 256色分色を記憶可能
06000000-06017FFF | 96KB | 16bit | VRAM | LCD に表示するデータを入れる
07000000-070003FF | 1KB | 32bit | OAM | オブジェクトと背景を重ねる機能

**外部メモリ (Game Pak)**

Game Pak = カートリッジのことです。

アドレス | サイズ | バス幅 | 名称 | 備考
---- | ---- | ---- | ---- | ----
08000000-09FFFFFF | 32MB | 16bit | Game Pak ROM/FlashROM | WaitState 0
0A000000-0BFFFFFF | 32MB | 16bit | Game Pak ROM/FlashROM | WaitState 1
0C000000-0DFFFFFF | 32MB | 16bit | Game Pak ROM/FlashROM | WaitState 2
0E000000-0E00FFFF | 64KB | 8bit | SRAM | --
0E010000-0FFFFFFF | -- | -- | 未使用 | -- 

**未使用領域**

アドレス | サイズ | バス幅 | 名称 | 備考
---- | ---- | ---- | ---- | ----
10000000-FFFFFFFF | -- | -- | 未使用 | -- 

## WRAMについて

デフォルトでは、WRAMの`0x0300_7F00-0x0300_7FFF`の256バイトは、割り込みベクタ、割り込みスタック、BIOSコールスタック用に予約されています。

残りのWRAMは、`0x0300_7F00`から配置されているユーザースタックを含めてどのような用途にも自由に使用できます。

## アクセス

バス幅とCPUが一度に読み書き可能なbit数、アクセスに要するサイクルの一覧です。

メモリ領域 | バス幅 | Read幅 | Write幅 | サイクル(8/16/32bit) | 備考(後述)
---- | ---- | ---- | ---- | ---- | ---- 
BIOS      | 32  |  8/16/32  | -       |  1/1/1 | --
WRAM(オンボード) | 16  |  8/16/32  | 8/16/32 |  3/3/6 | ②
WRAM(チップ)  | 32  |  8/16/32  | 8/16/32 |  1/1/1 | --
IOレジスタ           | 32  |  8/16/32  | 8/16/32 |  1/1/1 | --
パレット   | 16  |  8/16/32  | 16/32   |  1/1/2 | ①
VRAM          | 16  |  8/16/32  | 16/32   |  1/1/2 | ①
OAM           | 32  |  8/16/32  | 16/32   |  1/1/1 | ①
GamePak ROM   | 16  |  8/16/32  | -       |  5/5/8 | ②,③
GamePak Flash | 16  |  8/16/32  | 16/32   |  5/5/8 | ②,③
GamePak SRAM  | 8   |  8        | 8       |  5     | ②

これ以外にも16bitごとまたは32bitごとのDMA転送がSRAMをのぞいた全てのメモリに可能です。

備考について

- ①: GBAが同時にビデオメモリにアクセスする場合はプラス1サイクル。
- ②: サイクルはwaitstateの設定によって変わってきます。
- ③: シーケンシャルアクセスと非シーケンシャルアクセスのタイミングを分けます。

## VRAM、OAM、パレット

これらのメモリ領域は、HBlank中またはVBlank中のみアクセス可能です。 DISPCNTレジスタの強制白塗りビットで表示が無効化されているときはそれ以外のタイミングでもアクセスできます。

OAMメモリには追加の制限があります。DISPCNTの'H-Blank Interval Free'がセットされている場合にのみ、H-Blank中のアクセスが許可されます（これは表示可能なOBJの数を減らすことになりますが）。

## GamePak(カートリッジ)

CPUとDMA3のみがGamePak ROMにアクセスできます。

SRAMにはCPUしかアクセスできず一度に8bitごとしかアクセスできません。 SRAMは電池形式とフラッシュメモリ形式があります。

GamePak ROMのバスは16bitに制限されているため、GamePak ROMの内部からARM命令（32bit）を実行すると、あまり良いパフォーマンスが得られません。

よってTHUMB命令(16bit)を使うことをお勧めします。(ARM命令があった場合はGamePak ROMから内部のWRAMにコードをコピーすることで、最高のパフォーマンスを発揮することができます)

## データフォーマット

GBAでは常にデータはリトルエンディアン形式です。
